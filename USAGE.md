# 使用指南

本指南将帮助您了解如何使用世界职业技能大赛 AI 评分系统的各项功能。

## 目录

1. [系统登录](#系统登录)
2. [用户管理](#用户管理)
3. [赛事管理](#赛事管理)
4. [赛项管理](#赛项管理)
5. [模块管理](#模块管理)
6. [评分标准设置](#评分标准设置)
7. [比赛流程](#比赛流程)
8. [评分管理](#评分管理)
9. [AI评估使用](#ai评估使用)

## 系统登录

### 首次登录

1. 打开浏览器访问 `http://localhost:3000`
2. 使用默认管理员账号登录：
   - 用户名: `admin`
   - 密码: `admin123`
3. **重要**: 首次登录后，请立即在用户管理中修改管理员密码

### 测试账号

如果已运行 `npm run test-data` 创建测试数据，可使用以下账号：

| 角色 | 用户名 | 密码 | 权限说明 |
|------|--------|------|----------|
| 管理员 | admin | admin123 | 全部权限 |
| 裁判长 | chief_judge1 | test123 | 管理分配的赛项 |
| 裁判 | judge1, judge2 | test123 | 评分分配的选手 |
| 选手 | contestant1-3 | test123 | 查看和提交答题 |

## 用户管理

**权限要求**: 仅管理员可访问

### 创建用户

1. 点击左侧菜单"用户管理"
2. 点击"添加用户"按钮
3. 填写用户信息：
   - 用户名（登录用）
   - 姓名（显示用）
   - 角色（管理员/裁判长/裁判/选手）
   - 密码
4. 点击"提交"

### 编辑用户

1. 在用户列表中找到要编辑的用户
2. 点击"编辑"按钮
3. 修改信息（密码留空表示不修改）
4. 点击"提交"

### 删除用户

1. 在用户列表中找到要删除的用户
2. 点击"删除"按钮
3. 确认删除

## 赛事管理

**权限要求**: 管理员、裁判长、裁判、选手（只读）

### 创建赛事

1. 点击"赛事管理"菜单
2. 点击"添加赛事"
3. 填写赛事信息：
   - 赛事名称（如"第三届中华人民共和国职业技能大赛"）
   - 开始时间
   - 结束时间
4. 点击"提交"

### 编辑/删除赛事

在赛事列表中点击相应的操作按钮

## 赛项管理

**权限要求**: 管理员、裁判长可编辑，其他角色只读

### 创建赛项

1. 点击"赛项管理"菜单
2. 点击"添加赛项"
3. 填写赛项信息：
   - 选择所属赛事
   - 赛项名称（如"移动应用开发"）
   - 开始时间
   - 结束时间
4. 点击"提交"

### 分配人员

**管理员**可以分配裁判长、裁判、选手到赛项：

1. 在赛项列表中找到目标赛项
2. 点击相应的分配按钮：
   - "分配裁判长"
   - "分配裁判"
   - "分配选手"
   - "分配裁判-选手"（指定哪个裁判负责哪个选手）
3. 在弹出窗口中选择用户
4. 点击"提交"

### 分配说明

- **裁判长**: 可以管理该赛项的所有模块、评分标准
- **裁判**: 只能看到和评分分配给自己的选手
- **选手**: 可以查看模块、提交答题
- **裁判-选手关联**: 必须设置，否则裁判无法评分

## 模块管理

**权限要求**: 管理员、裁判长可编辑

### 创建模块

1. 点击"模块管理"菜单
2. 点击"添加模块"
3. 填写模块信息：
   - 选择所属赛项
   - 模块名称（如"APP原型设计"）
   - 时长（分钟）
4. 点击"提交"

### 模块状态

模块有三种状态：

| 状态 | 说明 | 选手权限 | 裁判权限 |
|------|------|----------|----------|
| 未开始 | 初始状态 | 看不到赛题 | 可见赛题 |
| 进行中 | 比赛中 | 可查看赛题和提交答题 | 可见赛题和答题 |
| 已结束 | 结束 | 不可提交 | 可评分，触发AI评估 |

### 更改状态

1. 在模块列表中找到目标模块
2. 使用状态下拉框选择新状态
3. 系统自动保存

**重要**: 当状态变更为"已结束"时，如果该模块注册了AI评估插件，系统会自动执行AI评估。

## 评分标准设置

**权限要求**: 管理员、裁判长

### 创建评分标准

1. 在模块管理页面，点击模块的"评分标准"按钮
2. 如果尚未创建，点击"创建评分标准"
3. 添加评分项

### 添加评分项

评分项字段说明：

- **描述**: 评分标准的详细说明（支持HTML格式）
  - 示例: "评估 01.jpeg 的整体界面布局合理性"
  - 对于APP原型设计，需要指定评估哪张图片
- **评估类型**: 
  - **客观**: AI会给出具体分数
  - **主观**: AI会给出评估建议文本
- **满分**: 该项的最高分数（小数点后两位）
- **排序**: 控制评分项显示顺序

### 示例：APP原型设计评分标准

```
评分项1:
- 描述: 评估 01.jpeg 的整体界面布局合理性和美观度
- 类型: 主观
- 满分: 10.00

评分项2:
- 描述: 评估 02.jpeg 的色彩搭配是否符合设计规范
- 类型: 客观
- 满分: 15.00

评分项3:
- 描述: 评估 03.jpeg 的导航结构是否清晰易用
- 类型: 客观
- 满分: 15.00
```

## 比赛流程

### 1. 准备阶段（管理员/裁判长）

1. 创建用户（裁判、选手）
2. 创建赛事
3. 创建赛项并分配人员
4. 创建模块
5. 上传赛题附件（如有）
6. 设置评分标准
7. 确保所有配置正确

### 2. 开始比赛（裁判长）

1. 将模块状态改为"进行中"
2. 通知选手可以开始

### 3. 比赛中（选手）

选手登录后：

1. 进入模块管理，查看"进行中"的模块
2. 点击模块可查看赛题
3. 完成答题后，上传答题附件
4. 可上传多个文件

**注意**: 只有"进行中"的模块才能提交答题

### 4. 结束比赛（裁判长）

1. 时间到后，将模块状态改为"已结束"
2. 系统自动触发AI评估（如果已注册插件）
3. 选手无法再提交答题

### 5. 评分阶段（裁判）

裁判登录后：

1. 进入"评分管理"
2. 选择要评分的模块
3. 点击选手的"查看/评分"按钮
4. 查看每个评分项的：
   - 评分标准
   - AI评分（客观题）
   - AI建议（主观题）
5. 输入裁判评分
6. 系统自动保存

## 评分管理

**权限要求**: 管理员、裁判长、裁判

### 裁判评分流程

1. 选择模块
2. 查看选手列表（只能看到分配给自己的选手）
3. 点击"查看/评分"
4. 逐项评分：
   - 参考AI评分和建议
   - 输入裁判给分
   - 自动保存
5. 查看总分

### 评分说明

- **AI评分**: 仅对客观题有效，由AI模型自动生成
- **AI建议**: 对主观题提供评估建议，供裁判参考
- **裁判评分**: 裁判的最终给分，可以参考但不必完全依赖AI评分

## AI评估使用

### APP原型设计模块

系统已内置APP原型设计评估插件，使用方法：

1. 创建名为"APP原型设计"的模块
2. 设置评分标准，在描述中指定图片：
   ```
   评估 01.jpeg 的界面布局
   评估 02.jpeg 的配色方案
   ...
   ```
3. 选手提交01.jpeg到10.jpeg
4. 模块结束时自动触发AI评估
5. AI会调用视觉模型分析每张图片并生成评分/建议

### 注册自定义评估器

开发者可以创建自定义AI评估插件：

```javascript
// 在 src/plugins/ 中创建新文件
const { aiRegistry, callVisionModel } = require('../services/aiEvaluator');

async function customEvaluator(scoringCriteria, problemAttachments, answerAttachments) {
  const results = [];
  
  for (const item of scoringCriteria.items) {
    // 实现评估逻辑
    // ...
    
    results.push({
      scoring_item_id: item.id,
      ai_score: score,  // 客观题分数
      ai_suggestion: suggestion  // 主观题建议
    });
  }
  
  return results;
}

// 注册到某个模块
aiRegistry.register(moduleId, customEvaluator);
```

### AI模型配置

在 `.env` 文件中配置：

```env
OPENAI_API_KEY=你的API密钥
OPENAI_BASE_URL=API端点
AI_MODEL=qwen3-vl-32b
```

## 常见问题

### Q: 选手看不到赛题？

A: 检查模块状态是否为"进行中"

### Q: 选手无法提交答题？

A: 
1. 检查模块状态是否为"进行中"
2. 检查选手是否已分配到该赛项

### Q: 裁判看不到某个选手？

A: 检查是否已设置"裁判-选手"关联

### Q: AI评估没有执行？

A: 
1. 检查是否为该模块注册了评估插件
2. 检查 `.env` 中的AI配置是否正确
3. 查看服务器日志了解错误信息

### Q: 如何查看AI评估日志？

A: 查看服务器控制台输出，所有AI评估过程都会打印日志

### Q: 可以修改已提交的答题吗？

A: 只要模块仍处于"进行中"状态，选手可以删除并重新上传答题附件

### Q: 评分可以修改吗？

A: 裁判可以随时修改自己的评分，输入新分数后自动保存

## 技术支持

如遇到问题，请：

1. 查看服务器日志：`pm2 logs` 或控制台输出
2. 检查数据库连接
3. 查看浏览器控制台错误
4. 参考 INSTALL.md 中的故障排除部分
